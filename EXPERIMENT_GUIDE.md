# üî¨ –ü–æ–≤–Ω–∏–π –≥—ñ–¥ –∑ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É DSS

–î–µ—Ç–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É "Stability-Aware Proxy –¥–ª—è –±—é–¥–∂–µ—Ç–Ω–æ–≥–æ Bayesian Optimization"

## üìã –ó–º—ñ—Å—Ç

1. [–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞](#–ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–µ–¥–æ–≤–∏—â–∞)
2. [–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞—Ç–∞—Å–µ—Ç—É](#–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è-–¥–∞—Ç–∞—Å–µ—Ç—É)
3. [–ó–∞–ø—É—Å–∫ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É](#–∑–∞–ø—É—Å–∫-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É)
4. [–ê–Ω–∞–ª—ñ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤](#–∞–Ω–∞–ª—ñ–∑-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤)
5. [–ü–æ–≤–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è](#–ø–æ–≤–Ω–µ-–Ω–∞–≤—á–∞–Ω–Ω—è)
6. [–û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏](#–æ—á—ñ–∫—É–≤–∞–Ω—ñ-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏)
7. [Troubleshooting](#troubleshooting)

---

## 1. –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

### –õ–æ–∫–∞–ª—å–Ω–æ (Mac M2 Pro / Linux / Windows)

```bash
# –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
git clone https://github.com/asterindex/composite_score_nas.git
cd composite_score_nas

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ—á–µ–Ω–Ω—è
python3 -m venv .venv
source .venv/bin/activate  # –ù–∞ Windows: .venv\Scripts\activate

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
pip install --upgrade pip
pip install -r requirements.txt
```

### Google Colab

–î–∏–≤—ñ—Ç—å—Å—è [COLAB_GUIDE.md](COLAB_GUIDE.md)

---

## 2. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞—Ç–∞—Å–µ—Ç—É

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç—É
./download_val.sh
```

–¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π –¥–∞—Ç–∞—Å–µ—Ç –≤–∂–µ –º–∞—î –±—É—Ç–∏ —É `data/train/`

### –í—Ä—É—á–Ω—É

1. **Train:** https://drive.google.com/file/d/1a2oHjcEcwXP8oUF95qiwrqzACb2YlUhn
2. **Val:** https://drive.google.com/file/d/1bxK5zgLn0_L8x276eKkuYA_FzwCIjb59

–†–æ–∑–ø–∞–∫—É–π—Ç–µ —É `data/`:

```
data/
‚îú‚îÄ‚îÄ train/
‚îÇ   ‚îú‚îÄ‚îÄ images/ (6471 –∑–æ–±—Ä–∞–∂–µ–Ω—å)
‚îÇ   ‚îî‚îÄ‚îÄ annotations/ (6471 —Ñ–∞–π–ª—ñ–≤)
‚îî‚îÄ‚îÄ val/
    ‚îú‚îÄ‚îÄ images/ (548 –∑–æ–±—Ä–∞–∂–µ–Ω—å)
    ‚îî‚îÄ‚îÄ annotations/ (548 —Ñ–∞–π–ª—ñ–≤)
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç—É

```bash
python dataset_utils.py
```

–û—á—ñ–∫—É–≤–∞–Ω–∏–π –≤–∏–≤—ñ–¥:

```
============================================================
VisDrone Dataset Statistics: train
============================================================
üì∏ –ó–æ–±—Ä–∞–∂–µ–Ω—å: 6471
üì¶ –û–±'—î–∫—Ç—ñ–≤: 389823
üìä –°–µ—Ä–µ–¥–Ω—è –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–±'—î–∫—Ç—ñ–≤ –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è: 60.24
```

---

## 3. –ó–∞–ø—É—Å–∫ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É

### –¢–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø—É—Å–∫ (3 trials)

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å:

```bash
python quick_test.py
```

**–ß–∞—Å:** ~2-3 —Ö–≤–∏–ª–∏–Ω–∏  
**–©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è:**
- ‚úÖ –î–∞—Ç–∞—Å–µ—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è
- ‚úÖ –ú–æ–¥–µ–ª—å —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è
- ‚úÖ –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—î
- ‚úÖ DSS –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è

‚ö†Ô∏è **–ü—ñ—Å–ª—è —Ç–µ—Å—Ç—É –≤–∏–¥–∞–ª—ñ—Ç—å `results/` –ø–µ—Ä–µ–¥ –ø–æ–≤–Ω–∏–º –∑–∞–ø—É—Å–∫–æ–º!**

```bash
rm -rf results/
```

### –ü–æ–≤–Ω–∏–π –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç (30 trials)

```bash
python synthesis_universal.py
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `N_TRIALS = 30` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±
- `N_WARMUP = 10` - warmup –¥–ª—è –∫–∞–ª—ñ–±—Ä–∞—Ü—ñ—ó
- `EPOCHS_PER_TRIAL = 1` - —à–≤–∏–¥–∫–∞ –æ—Ü—ñ–Ω–∫–∞
- `MAX_SAMPLES = 700` - –ø—ñ–¥–º–Ω–æ–∂–∏–Ω–∞ train
- `VAL_SUBSET = 200` - —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
- `SEED = 42` - –≤—ñ–¥—Ç–≤–æ—Ä—é–≤–∞–Ω—ñ—Å—Ç—å

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —á–∞—Å:**
- üñ•Ô∏è M2 Pro (MPS): 15-18 —Ö–≤–∏–ª–∏–Ω
- üî• T4 GPU: 10-12 —Ö–≤–∏–ª–∏–Ω
- üíª CPU: 45-50 —Ö–≤–∏–ª–∏–Ω

**–ü—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:**

```
[2026-01-24 12:34:56 UTC] üöÄ –ó–∞–ø—É—Å–∫ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É: 20260124_123456 UTC
[2026-01-24 12:34:56 UTC] üìç Platform: MPS | Colab: False
[2026-01-24 12:34:57 UTC] üì¶ Dataset train: 6471 –∑–æ–±—Ä–∞–∂–µ–Ω—å
[2026-01-24 12:34:57 UTC] üì¶ Dataset val: 548 –∑–æ–±—Ä–∞–∂–µ–Ω—å
...
[2026-01-24 12:35:00 UTC] üîç Trial 1/30 (WARMUP)
[2026-01-24 12:35:00 UTC] üèóÔ∏è  Architecture: 3 blocks, filters=[32,64,128], kernels=[3,5,3]
[2026-01-24 12:35:02 UTC] üî• Warmup proxy: 1.2345
...
[2026-01-24 12:40:00 UTC] üìä –ö–∞–ª—ñ–±—Ä–æ–≤–∞–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ 10 warmup trials
[2026-01-24 12:40:05 UTC] üîç Trial 11/30
[2026-01-24 12:40:07 UTC] ‚ú® DSS: -0.8234
...
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç–∏:**
- `results/optuna_study.pkl` - Optuna study
- `results/proxy_stats.json` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–ª—ñ–±—Ä–∞—Ü—ñ—ó
- `results/synthesis_results.json` - –¢–æ–ø-3 –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
- `results/experiment_*.log` - –ü–æ–≤–Ω–∏–π –ª–æ–≥

---

## 4. –ê–Ω–∞–ª—ñ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

```bash
python analyze_results.py
```

**–©–æ –∞–Ω–∞–ª—ñ–∑—É—î—Ç—å—Å—è:**
1. –ö–æ–Ω–≤–µ—Ä–≥–µ–Ω—Ü—ñ—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó (–≥—Ä–∞—Ñ—ñ–∫)
2. –í–∞–∂–ª–∏–≤—ñ—Å—Ç—å –≥—ñ–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
3. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ —Ç–æ–ø-10
4. –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è baseline vs DSS
5. –î–µ—Ç–∞–ª—å–Ω–∏–π JSON-–∑–≤—ñ—Ç

**–í–∏–≤—ñ–¥:**

```
============================================================
üìä –ê–Ω–∞–ª—ñ–∑ —Ç–æ–ø-10 –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä
============================================================

n_blocks:
   Mean: 3.800
   Std: 0.422

activation:
   leaky_relu: 6/10 (60%)
   gelu: 3/10 (30%)
   relu: 1/10 (10%)

optimizer:
   adamw: 8/10 (80%)
   sgd: 2/10 (20%)

lr:
   0.001: 7/10 (70%)
   0.01: 3/10 (30%)

============================================================
üèóÔ∏è  –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ (—Ç–æ–ø-10)
============================================================

üìê –ì–ª–∏–±–∏–Ω–∞ (n_blocks):
   3 blocks: 2/10
   4 blocks: 8/10

üî¢ –ü–∞—Ç—Ç–µ—Ä–Ω–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤:
   #1: filters=[64,64,64,128], kernels=[5,5,5,3]
   #2: filters=[64,32,16,32], kernels=[5,5,5,3]
   #3: filters=[64,32,16,128], kernels=[5,5,5,3]
   #4: filters=[32,64,64,128], kernels=[5,5,3,3]
   #5: filters=[64,64,128,128], kernels=[5,3,5,3]
```

**–ì—Ä–∞—Ñ—ñ–∫–∏:**
- `results/convergence.png` - –ö–æ–Ω–≤–µ—Ä–≥–µ–Ω—Ü—ñ—è trials
- `results/analysis_report.json` - –î–µ—Ç–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç

---

## 5. –ü–æ–≤–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è

–ù–∞–≤—á–∞–Ω–Ω—è —Ç–æ–ø-3 –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä –Ω–∞ 25 –µ–ø–æ—Ö:

```bash
python train_top3_models.py
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `FULL_EPOCHS = 25`
- `TOP_K = 3`
- Scheduler: ReduceLROnPlateau
- Early stopping: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–π–∫—Ä–∞—â–æ—ó –º–æ–¥–µ–ª—ñ

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —á–∞—Å:**
- üî• T4 GPU: ~30-40 —Ö–≤–∏–ª–∏–Ω
- üñ•Ô∏è M2 Pro: ~50-60 —Ö–≤–∏–ª–∏–Ω

**–í–∏–≤—ñ–¥:**

```
============================================================
üöÄ –ü–æ–≤–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è Trial #17
============================================================
   Epoch 1/25: train_loss=1.2345, val_loss=1.3456 (12.3s)
   Epoch 2/25: train_loss=1.1234, val_loss=1.2345 (12.1s)
   ...
   Epoch 25/25: train_loss=0.4567, val_loss=0.5678 (12.0s)

‚úÖ –ù–∞–≤—á–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ 5.12 —Ö–≤
üèÜ –ù–∞–π–∫—Ä–∞—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: val_loss=0.5234 (epoch 23)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç–∏:**
- `results/trained_models/trial_*_best.pth` - –ù–∞–π–∫—Ä–∞—â—ñ –º–æ–¥–µ–ª—ñ
- `results/final_results.json` - –§—ñ–Ω–∞–ª—å–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏

---

## 6. –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –ù–∞–π–∫—Ä–∞—â–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ (DSS = -1.1032)

```
üèóÔ∏è Architecture:
   - 4 conv-–±–ª–æ–∫–∏
   - Filters: [64, 64, 64, 128]
   - Kernels: [5√ó5, 5√ó5, 5√ó5, 3√ó3]
   - FC layer: 64
   - Dropout: 0.5
   - Activation: LeakyReLU

‚öôÔ∏è Training:
   - Optimizer: AdamW
   - Learning rate: 0.001
   - Weight decay: 0
   - Batch size: 32

üìä Performance:
   - Proxy DSS: -1.1032
   - Best val loss: 0.5234 (epoch 23)
```

### –ö–ª—é—á–æ–≤—ñ –∑–Ω–∞—Ö—ñ–¥–∫–∏

1. **–û–ø—Ç–∏–º–∞–ª—å–Ω–∞ –≥–ª–∏–±–∏–Ω–∞:** 4 –±–ª–æ–∫–∏ (100% —Ç–æ–ø-5)
2. **–†–æ–∑–º—ñ—Ä —è–¥–µ—Ä:** 5√ó5 –¥–ª—è –ø–µ—Ä—à–∏—Ö –±–ª–æ–∫—ñ–≤ (–∫—Ä–∞—â–∞ feature extraction)
3. **–§—ñ–ª—å—Ç—Ä–∏:** 64 –∑–∞–º—ñ—Å—Ç—å 16-32 (–∫—Ä–∞—â–∞ —î–º–Ω—ñ—Å—Ç—å)
4. **Learning rate:** 0.001 (—Å—Ç–∞–±—ñ–ª—å–Ω—ñ—à–µ –Ω–∞–≤—á–∞–Ω–Ω—è)
5. **Dropout:** 0.5 (–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞ —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü—ñ—è)

### –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ baseline

| –ú–µ—Ç—Ä–∏–∫–∞ | Baseline (val_loss) | DSS |
|---------|---------------------|-----|
| Proxy value | 1.1029 | -1.1032 |
| n_blocks | 3 | 4 |
| Filters | [32,32,128] | [64,64,64,128] |
| LR | 0.01 | 0.001 |
| –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è | - | **+8.5%** |

---

## 7. Troubleshooting

### –î–∞—Ç–∞—Å–µ—Ç –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª—ñ–≤
ls -lh data/train/images | wc -l  # –ú–∞—î –±—É—Ç–∏ 6471
ls -lh data/val/images | wc -l    # –ú–∞—î –±—É—Ç–∏ 548

# –Ø–∫—â–æ —Ñ–∞–π–ª—ñ–≤ –Ω–µ–º–∞—î - –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –≤—Ä—É—á–Ω—É
```

### CUDA/MPS –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ

```python
import torch
print(f"CUDA: {torch.cuda.is_available()}")
print(f"MPS: {torch.backends.mps.is_available()}")
```

–Ø–∫—â–æ `False` - –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –Ω–∞ CPU (–ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ)

### Out of Memory

–ó–º–µ–Ω—à—ñ—Ç—å `batch_size` —É `synthesis_universal.py`:

```python
batch_size = trial.suggest_categorical('batch_size', [8, 16])  # –ó–∞–º—ñ—Å—Ç—å [16, 32, 64]
```

### Optuna study –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è

```bash
# –í–∏–¥–∞–ª—ñ—Ç—å –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π —Ñ–∞–π–ª
rm results/optuna_study.pkl

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç
python synthesis_universal.py
```

### –†—ñ–∑–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö

–¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ —á–∏—Å–ª–æ–≤—É —Ç–æ—á–Ω—ñ—Å—Ç—å (—Ä—ñ–∑–Ω–∏—Ü—è < 5%). –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ –º–∞—î –±—É—Ç–∏ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—é.

---

## üìö –î–æ–¥–∞—Ç–∫–æ–≤—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏

- üìñ [README.md](README.md) - –û–≥–ª—è–¥ –ø—Ä–æ–µ–∫—Ç—É
- üöÄ [COLAB_GUIDE.md](COLAB_GUIDE.md) - –ó–∞–ø—É—Å–∫ –Ω–∞ Colab
- üìä [dataset_utils.py](dataset_utils.py) - –£—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç—É
- üß™ [quick_test.py](quick_test.py) - –®–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç

---

## üìù –¶–∏—Ç—É–≤–∞–Ω–Ω—è

```bibtex
@article{kot2026stability,
  title={Stability-Aware Proxy –¥–ª—è –±—é–¥–∂–µ—Ç–Ω–æ–≥–æ Bayesian Optimization —É –¥–µ—Ç–µ–∫—Ü—ñ—ó –æ–±'—î–∫—Ç—ñ–≤},
  author={Kot, Anatoly},
  year={2026},
  url={https://github.com/asterindex/composite_score_nas}
}
```

---

**–ê–≤—Ç–æ—Ä:** –ê–Ω–∞—Ç–æ–ª—ñ–π –ö–æ—Ç  
**Email:** [–≤–∞—à email]  
**–î–∞—Ç–∞:** 2026-01-24  
**GitHub:** https://github.com/asterindex/composite_score_nas
