# Composite Score NAS

–ü—Ä–æ–µ–∫—Ç –∑ Neural Architecture Search –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Composite Score –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–æ—Ä–µ–ª—è—Ü—ñ–π–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
composite_score_nas/
‚îÇ
‚îú‚îÄ‚îÄ üìÇ bayesian_optimization/          # –ë–∞–π—î—Å—ñ–≤—Å—å–∫–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ synthesis_universal.py         # üî¨ –û—Å–Ω–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ç–µ–∑—É
‚îÇ   ‚îî‚îÄ‚îÄ üìÇ results/                    # –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ñ–≤
‚îÇ       ‚îú‚îÄ‚îÄ colab_results.log          # –õ–æ–≥–∏ –∑ Google Colab
‚îÇ       ‚îú‚îÄ‚îÄ model_rank1.pt            # üèÜ –ù–∞–π–∫—Ä–∞—â–∞ –º–æ–¥–µ–ª—å
‚îÇ       ‚îú‚îÄ‚îÄ proxy_stats.json          # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ proxy –º–µ—Ç—Ä–∏–∫
‚îÇ       ‚îú‚îÄ‚îÄ synthesis_results.json    # –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∏–Ω—Ç–µ–∑—É
‚îÇ       ‚îú‚îÄ‚îÄ top3_models.json          # –¢–æ–ø-3 –º–æ–¥–µ–ª—ñ
‚îÇ       ‚îú‚îÄ‚îÄ trials_proxy_metrics.csv  # –ú–µ—Ç—Ä–∏–∫–∏ –≤—Å—ñ—Ö trials
‚îÇ       ‚îî‚îÄ‚îÄ val_subset_idx.npy        # –í–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏
‚îÇ
‚îú‚îÄ‚îÄ üìÇ correlation_experiment/         # –ö–æ—Ä–µ–ª—è—Ü—ñ–π–Ω–∏–π –∞–Ω–∞–ª—ñ–∑
‚îÇ   ‚îú‚îÄ‚îÄ correlation_experiment.py      # –û—Å–Ω–æ–≤–Ω–∏–π –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ analyze_*.py                   # –†—ñ–∑–Ω—ñ –∞–Ω–∞–ª—ñ–∑–∏
‚îÇ   ‚îî‚îÄ‚îÄ üìÇ results/                    # –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∫–æ—Ä–µ–ª—è—Ü—ñ—ó
‚îÇ       ‚îú‚îÄ‚îÄ all_metrics_per_epoch.csv
‚îÇ       ‚îú‚îÄ‚îÄ correlation_analysis.csv
‚îÇ       ‚îî‚îÄ‚îÄ models_config.json
‚îÇ
‚îî‚îÄ‚îÄ üìÇ dataset/                        # –î–∞—Ç–∞—Å–µ—Ç VisDrone
    ‚îú‚îÄ‚îÄ train/                         # –¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π –Ω–∞–±—ñ—Ä
    ‚îî‚îÄ‚îÄ val/                           # –í–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω–∏–π –Ω–∞–±—ñ—Ä
```

## üì¶ –î–∞—Ç–∞—Å–µ—Ç

–ü—Ä–æ–µ–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **VisDrone2019-DET** –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è –¥–µ—Ç–µ–∫—Ü—ñ—ó –æ–±'—î–∫—Ç—ñ–≤.

**üìñ –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:** [DATASET.md](DATASET.md)

### –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç:

**–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:**
- üåê GitHub: https://github.com/VisDrone/VisDrone-Dataset
- üì• –ü—Ä—è–º–∏–π –ª—ñ–Ω–∫: http://aiskyeye.com/download/object-detection-2/
- üìä –†–æ–∑–º—ñ—Ä: ~1.5 GB

**–î–ª—è Google Colab:**
1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ `dataset.zip` –Ω–∞ Google Drive
2. –ü–æ–º—ñ—Å—Ç—ñ—Ç—å —É `MyDrive/Studying/Experiments/Composite_score_nas/dataset.zip`
3. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∞–π–¥–µ —ñ —Ä–æ–∑–ø–∞–∫—É—î

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
```bash
# –†–æ–∑–ø–∞–∫—É–π—Ç–µ –≤ –ø–∞–ø–∫—É dataset/
unzip dataset.zip -d dataset/
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- Train: 6,471 –∑–æ–±—Ä–∞–∂–µ–Ω—å
- Val: 548 –∑–æ–±—Ä–∞–∂–µ–Ω—å
- –§–æ—Ä–º–∞—Ç: YOLO annotations

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ç–µ–∑—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

**–õ–æ–∫–∞–ª—å–Ω–æ (Mac/Linux):**
```bash
cd bayesian_optimization
python synthesis_universal.py
```

**–ù–∞ Google Colab:**
1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ `synthesis_universal.py` –≤ Colab
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç
3. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
   - üíæ –ó–±–µ—Ä–µ–∂—É—Ç—å—Å—è –Ω–∞ Google Drive (`MyDrive/Studying/composite_score_nas_results/`)
   - üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∞—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä (–∫–ª—é—á–æ–≤—ñ —Ñ–∞–π–ª–∏)

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
- –í–∏–∑–Ω–∞—á–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π (CUDA/MPS/CPU)
- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∞—Ç–∞—Å–µ—Ç (–Ω–∞ Colab –∑ Google Drive)
- –í–∏–∫–æ–Ω—É—î Bayesian Optimization –∑ Composite Score
- –ó–±–µ—Ä—ñ–≥–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —É –ø–∞–ø–∫—É `results/`
- **–ù–∞ Colab**: –∫–æ–ø—ñ—é—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –Ω–∞ Google Drive

### –ê–Ω–∞–ª—ñ–∑ –∫–æ—Ä–µ–ª—è—Ü—ñ–π

```bash
cd correlation_experiment
python correlation_experiment.py
```

## üìä Composite Score

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–≥–∞—Ç–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—É –æ—Ü—ñ–Ω–∫—É –º–æ–¥–µ–ª–µ–π:

```
Score = -0.701 √ó z(train_loss) - 0.671 √ó z(grad_norm_mean) + 0.406 √ó z(val_loss)
        -0.395 √ó z(train_loss_cv) + 0.311 √ó z(gap)
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- Spearman œÅ = 0.743 (–Ω–∞ 83% –∫—Ä–∞—â–µ –∑–∞ –ø—Ä–æ—Å—Ç–∏–π val_loss)
- –í—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
- –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –æ–≤–µ—Ä—Ñ—ñ—Ç–∏–Ω–≥—É

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–û—Å–Ω–æ–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —É `synthesis_universal.py`:

```python
N_TRIALS = 50              # –ö—ñ–ª—å–∫—ñ—Å—Ç—å trials
EPOCHS_PER_TRIAL = 2       # –ï–ø–æ—Ö–∏ –¥–ª—è –æ—Ü—ñ–Ω–∫–∏
MAX_SAMPLES = 2000         # –ó–æ–±—Ä–∞–∂–µ–Ω—å –¥–ª—è —Å–∏–Ω—Ç–µ–∑—É
VAL_SUBSET = 200           # –†–æ–∑–º—ñ—Ä validation subset
USE_COMPOSITE_PROXY = True # –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Composite Score
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É –≤ –ø–∞–ø—Ü—ñ `results/`:
- `synthesis_results.json` - **–ø–æ–≤–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∏–Ω—Ç–µ–∑—É** (–≤–∫–ª—é—á–∞—î —Ç–æ–ø-3 –º–æ–¥–µ–ª—ñ, —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è, –∫–æ—Ä–µ–ª—è—Ü—ñ—ó)
- `trials_proxy_metrics.csv` - –º–µ—Ç—Ä–∏–∫–∏ –≤—Å—ñ—Ö —Å–ø—Ä–æ–± Optuna
- `proxy_stats.json` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è Composite Score
- `val_subset_idx.npy` - —ñ–Ω–¥–µ–∫—Å–∏ validation subset
- `colab_results.log` - –ª–æ–≥–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (–Ω–∞ Colab)

### üîÑ Resume –∑ checkpoint (–Ω–∞ Colab)

**–Ø–∫—â–æ Colab –≤—ñ–¥–∫–ª—é—á–∏–≤—Å—è - –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞!**

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. –ó–Ω–∞—Ö–æ–¥–∏—Ç—å checkpoint —Ñ–∞–π–ª–∏ (`checkpoint.json`, `optuna_study.pkl`)
2. –í—ñ–¥–Ω–æ–≤–ª—é—î Optuna study –∑ —É—Å—ñ–º–∞ trials
3. –ü—Ä–æ–¥–æ–≤–∂—É—î —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó –º–æ–¥–µ–ª—ñ

**–ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å —Ç–æ–π —Å–∞–º–∏–π —Å–∫—Ä–∏–ø—Ç - –≤—ñ–Ω –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å –∑ –º—ñ—Å—Ü—è –∑—É–ø–∏–Ω–∫–∏!** ‚úÖ

Checkpoint'–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è:
- **–ü—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –º–æ–¥–µ–ª—ñ** ‚Üí `results/checkpoint.json`
- **–ù–∞ Google Drive** ‚Üí `MyDrive/Studying/Experiments/Composite_score_nas/checkpoint/`
- **–§—ñ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏** ‚Üí `results/` (–ª–æ–∫–∞–ª—å–Ω–æ) –∞–±–æ `results_full/` (–Ω–∞ Drive)

### –†–æ–±–æ—Ç–∞ –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Colab ‚Üí –ª–æ–∫–∞–ª—å–Ω–æ

**–í–∞—Ä—ñ–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Google Drive (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)**
1. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –Ω–∞ Colab —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤ `MyDrive/Studying/Experiments/Composite_score_nas/`
2. –°–∫–æ–ø—ñ—é–π—Ç–µ –ø–∞–ø–∫—É –ª–æ–∫–∞–ª—å–Ω–æ:
   ```bash
   # –ù–∞ Mac —á–µ—Ä–µ–∑ Google Drive Desktop
   cp -r ~/Google\ Drive/My\ Drive/Studying/Experiments/Composite_score_nas/results_full/* bayesian_optimization/results/
   ```

**–í–∞—Ä—ñ–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ñ–∞–π–ª–∏**
1. Colab –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∫–ª—é—á–æ–≤—ñ —Ñ–∞–π–ª–∏
2. –ü–æ–º—ñ—Å—Ç—ñ—Ç—å —ó—Ö —É `bayesian_optimization/results/`

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –º–æ–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑–∏ –ª–æ–∫–∞–ª—å–Ω–æ!

## üéØ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∏

–ü—Ä–∞—Ü—é—î –æ–¥–Ω–∞–∫–æ–≤–æ –Ω–∞:
- ‚úÖ Google Colab (CUDA)
- ‚úÖ M1/M2 Mac (MPS)
- ‚úÖ CPU

---

**–ê–≤—Ç–æ—Ä:** –ê–Ω–∞—Ç–æ–ª—ñ–π –ö–æ—Ç (Anatoly Kot)  
**–î–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 2026-01-09
